# 🔧 `net::ERR_INCOMPLETE_CHUNKED_ENCODING` 오류 해결 가이드

## 📋 오류 개요

`net::ERR_INCOMPLETE_CHUNKED_ENCODING` 오류는 HTTP 응답이 완전히 전송되지 않았을 때 발생하는 네트워크 오류입니다.

## 🎯 주요 원인

### 1. Nginx 프록시 설정 문제
- 청크 인코딩 처리 설정 부족
- 타임아웃 설정 부족
- 버퍼링 설정 문제

### 2. Next.js 응답 처리 문제
- 청크 크기 최적화 부족
- 메모리 사용량 과다
- 응답 스트리밍 처리 오류

### 3. Docker 컨테이너 리소스 부족
- 메모리 부족
- CPU 부족
- 네트워크 대역폭 제한

### 4. 네트워크 타임아웃
- 연결 타임아웃
- 응답 타임아웃
- 프록시 타임아웃

### 5. 브라우저 캐시 문제
- 오래된 청크 파일 캐시
- 잘못된 파일명 캐시
- 브라우저 캐시 충돌

## 🛠️ 해결 방법

### 1단계: 즉시 해결 스크립트 실행

```bash
# 스크립트 실행
./fix-chunked-encoding.sh
```

### 2단계: 브라우저 캐시 클리어 (중요!)

#### A. Chrome/Edge 브라우저
1. **개발자 도구 열기**: F12 또는 Ctrl+Shift+I
2. **Network 탭**에서 **Disable cache** 체크박스 활성화
3. **Application 탭** → **Storage** → **Clear storage** 클릭
4. **브라우저 강제 새로고침**: Ctrl+Shift+R (Windows) 또는 Cmd+Shift+R (Mac)

#### B. Firefox 브라우저
1. **개발자 도구 열기**: F12
2. **Network 탭**에서 **Disable Cache** 체크박스 활성화
3. **Storage 탭** → **Clear All** 클릭
4. **브라우저 강제 새로고침**: Ctrl+F5

#### C. Safari 브라우저
1. **개발자 도구 열기**: Cmd+Option+I
2. **Network 탭**에서 **Disable Caches** 체크박스 활성화
3. **Application 탭** → **Storage** → **Clear All** 클릭
4. **브라우저 강제 새로고침**: Cmd+Option+R

### 3단계: 수동 해결 방법

#### A. Docker 컨테이너 재시작

```bash
# 모든 컨테이너 중지
docker-compose down

# 시스템 정리
docker system prune -f

# 컨테이너 재시작
docker-compose up -d
```

#### B. Nginx 설정 확인

```bash
# Nginx 설정 테스트
docker exec ta-go-nginx nginx -t

# Nginx 재시작
docker-compose restart nginx
```

#### C. 로그 확인

```bash
# 실시간 로그 확인
docker-compose logs -f

# 특정 서비스 로그
docker-compose logs -f ta-go-frontend
docker-compose logs -f nginx
```

### 4단계: 고급 해결 방법

#### A. 리소스 모니터링

```bash
# 컨테이너 리소스 사용량 확인
docker stats

# 시스템 리소스 확인
htop
free -h
```

#### B. 네트워크 연결 테스트

```bash
# 포트 연결 확인
netstat -tlnp | grep :3011
netstat -tlnp | grep :80

# 헬스체크 테스트
curl -f http://localhost/health
curl -f http://localhost:3011/health
```

#### C. 청크 파일 직접 테스트

```bash
# 실제 청크 파일명 확인
curl -s http://localhost | grep -o '_next/static/chunks/[^"]*\.js' | head -5

# 특정 청크 파일 테스트
curl -s -o /dev/null -w "응답 코드: %{http_code}\n" http://localhost/_next/static/chunks/vendors-5a84622074cdb27d.js
```

## 🔍 진단 방법

### 1. 브라우저 개발자 도구 확인

1. **Network 탭**에서 실패한 요청 확인
2. **Console 탭**에서 오류 메시지 확인
3. **Performance 탭**에서 성능 병목 확인

### 2. 서버 로그 분석

```bash
# Nginx 액세스 로그
docker exec ta-go-nginx tail -f /var/log/nginx/access.log

# Nginx 에러 로그
docker exec ta-go-nginx tail -f /var/log/nginx/error.log

# 애플리케이션 로그
docker-compose logs -f ta-go-frontend
```

### 3. 네트워크 진단

```bash
# DNS 확인
nslookup ta-go.shop

# 연결 테스트
ping ta-go.shop

# 포트 스캔
nmap -p 80,443,3011 ta-go.shop
```

## 🚀 예방 방법

### 1. 정기적인 모니터링

```bash
# 헬스체크 스크립트
#!/bin/bash
while true; do
    if ! curl -f http://localhost/health; then
        echo "서비스 오류 발생: $(date)"
        docker-compose restart
    fi
    sleep 60
done
```

### 2. 리소스 제한 설정

```yaml
# docker-compose.yml
services:
  ta-go-frontend:
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'
```

### 3. 로그 로테이션 설정

```nginx
# nginx.conf
http {
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;
}
```

## 📞 추가 지원

### 문제가 지속되는 경우

1. **로그 파일 수집**
   ```bash
   docker-compose logs > logs.txt
   docker exec ta-go-nginx cat /var/log/nginx/error.log > nginx-error.log
   ```

2. **시스템 정보 수집**
   ```bash
   docker system df
   docker stats --no-stream
   free -h
   df -h
   ```

3. **네트워크 정보 수집**
   ```bash
   netstat -tlnp
   iptables -L
   ```

### 연락처

- **개발팀**: dev@ta-go.shop
- **시스템 관리자**: admin@ta-go.shop
- **긴급 지원**: emergency@ta-go.shop

---

**마지막 업데이트**: 2024년 12월  
**버전**: 1.1.0  
**작성자**: Ta-Go 개발팀
